
<html>
<head>
<title>Introduction to Programming in Ruby | Day 7 | ProPublica Data Institute 2016</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<link rel="stylesheet"  href="./style.css">
<script src="./slides.js"></script>
</head>

<body>
  <div>
    <h2>Introduction to Programming in Ruby</h2>

    <span style="display:block;text-align:center;font-size:20px;">&larr; Use arrow keys &rarr;</span>
  </div>

  <div>
    <h2>You are here: Intro to Ruby</h2>
  </div>

  <div>
    <h2>Today:<br />Basics of Ruby</br>Tomorrow:<br>RubyGems, working with data and scraping</h2>
  </div>

  <div>
    <h2>Day 1 Schedule</h2>
  </div>

  <div>
    <h2>1. Set up the room<br />2. Variables, types, conditionals, iteration<br />3. Methods and classes</h2>
  </div>
  
  <div>
    <h2>Set up the room.</h2>
  </div>

  <div class="code">
  <pre>
ruby yourfile.rb
  </pre>
  </div>

  <div class="code">
  <pre>
$ irb
irb(main):001:0> puts "hello"
hello
=> nil
  </pre>
  </div>

  <div class="code smaller">
  <pre>
$ irb
irb(main):001:0> require './my_script'
MyLibrary
=> MyLibrary
  </pre>
  </div>


<div>
  <h2>Intro.</h2>
</div>

<div>
  <h2>Programming is 3 things</h2>
</div>

<div>
  <h2>Assignment, Conditional, Iteration</h2>
</div>

<div>
  <h2>Assignment</h2>
</div>

<div class="code">
<pre>
name = "Al"
</pre>
</div>

<div>
  <h2>Conditional</h2>
</div>

<div class="code">
<pre>
if name == "Al"
  puts "Hello #{name}"
end
</pre>
</div>

<div>
  <h2>Iteration</h2>
</div>

<div class="code">
<pre>
names = ["Al", "Joe", "Sally"]
names.each do |name|
  puts "#{name} is here!"
end
</pre>
</div>

<div>
  <h2>Let's go!</h2>
</div>

<div>
  <h2>Strings & Integers</h2>
</div>

<div class="code">
<pre>
address  = 155
street   = "6th Ave"
city     = "New York"
state    = "NY"
zip_code = "10013"
</pre>
</div>

<div class="code">
<pre>
city + ", " + state
#=> "New York, NY"
</pre>
</div>

<div class="code">
<pre>
"#{city}, #{state}"
#=> "New York, NY"
</pre>
</div>

<div class="code">
<pre>
"#{address} #{street}"
#=> "155 6th Ave"
</pre>
</div>

<div class="code smaller">
<pre>
address + " " + street
#=> TypeError: String can't be coerced into Fixnum
  from (irb):10:in `+'
  from (irb):10
</pre>
</div>

<div class="code smaller">
<pre>
address.to_s + " " + street
#=> "155 6th Ave"
</pre>
</div>

<div>
  <h2>Type coercion</h2>
</div>

<div class="code">
<pre>
5.to_s    #=> "5"
"5".to_i  #=> 5
5.to_f    #=> 5.0
</pre>
</div>

<div class="code">
<pre>
str = ""
str &lt;&lt; city
str &lt;&lt; ", "
str &lt;&lt; state

#=> "New York, NY"
</pre>
</div>

<div class="code">
<pre>
str = ""
str += city
str += ", "
str += state

#=> "New York, NY"
</pre>
</div>


<div class="code">
<pre>
address += address
#=> 310
</pre>
</div>

<div class="code">
<pre>
= vs. ==
</pre>
</div>

<div class="code">
<pre>
a = 3
b = 3

a == b
#=> true
</pre>
</div>

<div class="code">
<pre>
a = 3
b = 3

if a == b
  puts 'they match'
end
</pre>
</div>

<div class="code">
<pre>
a = 1
b = 2

if a != b
  puts "They don't match!"
end
</pre>
</div>

<div class="code">
<pre>
a = 3
b = 3

if a == b
  puts "they match"
else
  puts "they don't match"
end
</pre>
</div>

<div>
  <h2>Arrays & Hashes</h2>
</div>

<div class="code">
<pre>
[]
</pre>
</div>

<div class="code smaller">
<pre>
students = ["Amy", "Joe", "Sally", "Harry"]
</pre>
</div>

<div class="code">
<pre>
students.pop
#=> "Harry"

students
#=> ["Amy", "Joe", "Sally"]
</pre>
</div>

<div class="code">
<pre>
students.shift
#=> "Amy"

students
#=> ["Joe", "Sally"]
</pre>
</div>

<div>
  <h2>What else can I do?</h2>
</div>

<div class="code smaller">
<pre>
(students.methods - Object.methods).sort
#=> [:&, :*, :+, :-, :<<, :[], :[]=, :all?, :any?, :assoc, ...]
</pre>
</div>

<div>
  <h2>Getting help</h2>
  <img src="./images/rubydocs.png">
</div>


<div class="code">
<pre>
students &lt;&lt; "Amy"
#=> ["Joe", "Sally", "Amy"]
</pre>
</div>

<div class="code">
<pre>
students[0]
#=> "Joe"
</pre>
</div>

<div class="code">
<pre>
students[1]
#=> ?
</pre>
</div>

<div class="code">
<pre>
students[1]
#=> "Sally"
</pre>
</div>

<div class="code">
<pre>
person = {}
</pre>
</div>

<div class="code">
<pre>
person = {}
person[:first_name] = "Al"
person[:last_name]  = "Shaw"
</pre>
</div>

<div class="code">
<pre>
person = {
  :first_name => "Al",
  :last_name  => "Shaw"
}
</pre>
</div>

<div class="code">
<pre>
person[:first_name]
#=> "Al"
</pre>
</div>

<div class="code smaller">
<pre>
people = []
people.push(person)
#=> [{:first_name=>"Al", :last_name=>"Shaw"}]
</pre>
</div>

<div>
  <h2>Iteration</h2>
</div>

<div class="code smaller">
<pre>
students.each do |student|
  puts "#{student} is in class today"
end

#=>
Joe is in class today
Sally is in class today
Amy is in class today
</pre>
</div>

<div class="code smaller">
<pre>
even_numbers = [2, 4, 6, 8, 10]
odd_numbers  = []
# how can we programmatically 
# fill up this array with odd numbers
</pre>
</div>

<div class="code smaller">
<pre>
even_numbers.each do |n|
  odd_numbers &lt;&lt; n + 1
end

odd_numbers
#=> [3, 5, 7, 9, 11]
</pre>
</div>

<div class="code smaller">
<pre>
even_numbers.map do |n|
  n + 1
end
#=> [3, 5, 7, 9, 11]
</pre>
</div>

<div class="code smaller">
<pre>
even_numbers.map { |n| n + 1 }
#=> [3, 5, 7, 9, 11]
</pre>
</div>

<div class="code smaller">
<pre>
even_numbers
#=> [2, 4, 6, 8, 10]

even_numbers.map! { |n| n + 1 }
#=> [3, 5, 7, 9, 11]
</pre>
</div>


<div>
  <h2>Methods</h2>
</div>

<div class="code">
<pre>
def add(a, b)
  a + b
end
</pre>
</div>

<div class="code">
<pre>
add(1, 2)
#=> 3
</pre>
</div>

<div class="code smaller">
<pre>
def full_address(address, street, state, zip)
  "#{address} #{street}, #{state}, {zip}"
end
</pre>
</div>

<div class="code smaller">
<pre>
# Who's in class today?
def is_in_class(student)
  attendance = {
    "Amy"   => true,
    "Joe"   => true,
    "Sally" => false,
    "Harry" => true
  }

  if attendance[student]
    "here"
  else
    "absent"
  end
end
</div>

<div class="code smaller">
<pre>
# Try it
is_in_class("Sally")
#=> Absent
is_in_class("Joe")
#=> Here
</pre>
</div>

<div>
  <h2>Everything in Ruby is an object</h2>
</div>

<div class="code">
<pre>
1.+(2)
#=> 3
</pre>
</div>

<div class="code">
<pre>
class Fixnum
  def +(num)
    self - num
  end
end
</pre>
</div>

<div class="code">
<pre>
1 + 2
#=> -1
</pre>
</div>

<div>
  <h2>I just blew your mind</h2>
</div>

<div>
  <h2>A useful example:</h2>
</div>


<div class="code smaller">
<pre>
[1,2,3].sum
NoMethodError: undefined method `sum' for [1, 2, 3]:Array
  from (irb):1
</pre>
</div>

<div class="code smaller">
<pre>
class Array
  def sum
    self.reduce(0) {|memo, it| memo += it; memo}
  end
end
</pre>
</div>

<div class="code smaller">
<pre>
[1,2,3].sum
#=> 6
</pre>
</div>


<div>
  <h2>Classes are factories for objects</h2>
</div>

<div class="code smaller">
<pre>
class Student
  attr_reader :name, :grade
  def initialize(name, grade)
    @name  = name
    @grade = grade
  end
end
</pre>
</div>

<div class="code smaller">
<pre>
s = Student.new("Sally", 8)
#=> #&lt;Student:0x1052aca28 @name="Sally", @grade=8&gt;

s.name
#=> "Sally"
</pre>
</div>

<div>
  <h2>Why should I care?</h2>
</div>

<div>
  <h2>Let's build a system that assigns students to teachers!</h2>
</div>

<div class="code">
<pre>
require './1_registrar'
</pre>
</div>

<div class="code smaller">
<pre style="font-size:20px;line-height:24px">
# 1_registrar.rb
class Student
  attr_reader :name, :grade, :teacher
  def initialize(name, grade)
    @name  = name
    @grade = grade
  end

  @@teachers = {
    "Shanahan"  => 5,
    "Kovacek"   => 5,
    "Streich"   => 5,
    "Ankunding" => 5,
    "Marks"     => 5
  }

  def assign_teacher
    @@teachers.each do |t_name, slots|
      if slots > 0
        @teacher = t_name
        @@teachers[t_name] -= 1
        puts "#{@name} is assigned to #{t_name}"
        puts "#{t_name} now has #{slots - 1} slots left"
        return
      end
    end
  end
end
</pre>
</div>

<div class="code smaller">
<pre>
s = Student.new("Sally", 8)
#=> #&lt;Student:0x1052aca28 @name="Sally", @grade=8&gt;

s.assign_teacher
Sally is assigned to Streich
Streich now has 4 slots left

s.teacher
#=> "Streich"
</pre>
</div>

<div>
  <h2>How could we change this to randomly assign teachers?</h2>
</div>

<div class="code smaller">
<pre style="font-size:20px;line-height:24px">
# 2_registrar_random.rb
class Student
  attr_reader :name, :grade, :teacher
  def initialize(name, grade)
    @name  = name
    @grade = grade
  end

  @@teachers = {
    "Shanahan"  => 5,
    "Kovacek"   => 5,
    "Streich"   => 5,
    "Ankunding" => 5,
    "Marks"     => 5
  }

  def random_list
    @@teachers.keys.shuffle
  end

  def assign_teacher
    random_list.each do |t_name|
      slots = @@teachers[t_name]
      if slots > 0
        @teacher = t_name
        @@teachers[t_name] -= 1
        puts "#{@name} is assigned to #{t_name}"
        puts "#{t_name} now has #{slots - 1} slots left"
        return
      end
    end
  end
end
</pre>
</div>

<div class="code smaller">
<pre>
s = Student.new("Sally", 8)
#=> #&lt;Student:0x007facfb97e870 @name="Sally", @grade=8&gt;

s.assign_teacher
Sally is assigned to Ankunding
Ankunding now has 4 slots left

s.teacher
#=> "Ankunding"
</pre>
</div>

<div>
  <h2>There are still two things wrong with this code. What are they?</h2>
</div>

<div>
  <h2>1. What happens when all the slots run out?<br>2. You can assign the same student to another teacher</h2>
</div>

<div><h2>Let's handle running out of slots</h2></div>

<div class="code smaller">
<pre style="font-size:20px;line-height:24px">
# 3_registrar_random_bugfix.rb
class Student
  attr_reader :name, :grade, :teacher
  def initialize(name, grade)
    @name  = name
    @grade = grade
  end

  @@teachers = {
    "Shanahan"  => 5,
    "Kovacek"   => 5,
    "Streich"   => 5,
    "Ankunding" => 5,
    "Marks"     => 5
  }

  def random_list
    @@teachers.keys.shuffle
  end

  def assign_teacher
    random_list.each_with_index do |t_name, idx|
      slots = @@teachers[t_name]
      if slots > 0
        @teacher = t_name
        @@teachers[t_name] -= 1
        puts "#{@name} is assigned to #{t_name}"
        puts "#{t_name} now has #{slots - 1} slots left"
        return
      end
      if idx == random_list.length - 1
        puts "There's no room for #{@name}"
      end
    end
  end
end
</pre>
</div>

<div>
  <h2>To test this, we'll use a hint from stuff we'll learn about tomorrow</h2>
</div>

<div>
  <h2>RubyGems are bits of code that add functionality to Ruby</h2>
</div>


<div class="code smaller">
<pre>
$ gem install faker
Successfully installed faker-1.6.3
1 gem installed
</pre>
</div>

<div class="code">
<pre>
require 'faker'
</pre>
</div>

<div class="code smaller">
<pre>
require './3_registrar_random_bugfix'
students = []
(0.upto(25)).each do |s| 
  students << Student.new(Faker::Name.name, 8)
end
</pre>
</div>

<div class="code smaller" >
<pre style="font-size:18px;line-height:20px;">
students
=&gt; [#&lt;Student:0x007fc7cbfca018 @name="Ms. Magdalena Lowe", @grade=8&gt;, 
#&lt;Student:0x007fc7cbfc96e0 @name="Alivia Wintheiser", 
@grade=8&gt;, #&lt;Student:0x007fc7cbfc8da8 @name="Jeanie Marks", @grade=8&gt;, 
...]
</pre>
</div>

<div class="code smaller" >
<pre style="font-size:12px;line-height:16px;">
students.each do |s|
  s.assign_teacher
end

Ms. Magdalena Lowe is assigned to Marks
Marks now has 4 slots left
Alivia Wintheiser is assigned to Shanahan
Shanahan now has 4 slots left
Jeanie Marks is assigned to Kovacek
Kovacek now has 4 slots left
Conrad Durgan is assigned to Kovacek
Kovacek now has 3 slots left
Kenneth Schaden is assigned to Marks
Marks now has 3 slots left
Bennett Olson I is assigned to Ankunding
Ankunding now has 4 slots left
Bud Mante V is assigned to Streich
Streich now has 4 slots left
Manuela Cole is assigned to Shanahan
Shanahan now has 3 slots left
Arch Schaden is assigned to Kovacek
Kovacek now has 2 slots left
Ophelia Carter is assigned to Shanahan
Shanahan now has 2 slots left
Lori Kovacek is assigned to Streich
Streich now has 3 slots left
Emmie Nienow DDS is assigned to Ankunding
Ankunding now has 3 slots left
Cecil Harvey is assigned to Kovacek
Kovacek now has 1 slots left
Clay Weber is assigned to Ankunding
Ankunding now has 2 slots left
Martin Wisoky is assigned to Marks
Marks now has 2 slots left
Orion Wehner is assigned to Kovacek
Kovacek now has 0 slots left
Miss Jo Welch is assigned to Ankunding
Ankunding now has 1 slots left
Karolann Grant is assigned to Ankunding
Ankunding now has 0 slots left
Jerry Franecki is assigned to Shanahan
Shanahan now has 1 slots left
Mrs. Taya Harris is assigned to Marks
Marks now has 1 slots left
Dusty Simonis V is assigned to Streich
Streich now has 2 slots left
Alexanne Ryan is assigned to Shanahan
Shanahan now has 0 slots left
Alfreda Effertz is assigned to Marks
Marks now has 0 slots left
Kaylie Buckridge IV is assigned to Streich
Streich now has 1 slots left
Kenton Rogahn I is assigned to Streich
Streich now has 0 slots left
There's no room for Rodger Wilkinson II
</pre>
</div>

<div class="code smaller">
<pre>
There's no room for Rodger Wilkinson II
</pre>
</div>

<div>
  <h2>If we really want Ruby to blow up when there's no more slots</h2>
</div>

<div class="code smaller">
<pre>
if idx == random_list.length - 1
  raise RuntimeError, "There's no room for #{@name}"
end
</pre>
</div>

<div class="code smaller" >
<pre style="font-size:14px;line-height:18px;">
Streich now has 0 slots left
RuntimeError: There's no room for Guiseppe Leffler
  from /Users/ashaw/rails/data-institute/code/3_registrar_random_bugfix.rb:31:in `block in assign_teacher'
  from /Users/ashaw/rails/data-institute/code/3_registrar_random_bugfix.rb:21:in `each'
  from /Users/ashaw/rails/data-institute/code/3_registrar_random_bugfix.rb:21:in `each_with_index'
  from /Users/ashaw/rails/data-institute/code/3_registrar_random_bugfix.rb:21:in `assign_teacher'
  from (irb):6:in `block in irb_binding'
  from (irb):6:in `each'
  from (irb):6
  from /usr/local/var/rbenv/versions/2.2.2/bin/irb:11:in `&lt;main&gt;'
</pre>
</div>

<div>
  <h2>Now that we know how to use exceptions, how do we make sure the same student doesn't get assigned to two teachers?</h2>
</div>

<div>
  <h2>First, let's do some refactoring</h2>
</div>

<div>
  <h2>Let's keep track of which teachers have which students</h2>
</div>

<div class="code smaller">
<pre style="font-size:14px;line-height:18px;">
#4_registrar_validated_step1.rb
class Student
  MAX_SLOTS = 5

  attr_reader :name, :grade, :teacher
  def initialize(name, grade)
    @name  = name
    @grade = grade
  end

  @@teachers = {
    "Shanahan"  => [],
    "Kovacek"   => [],
    "Streich"   => [],
    "Ankunding" => [],
    "Marks"     => []
  }

  def random_list
    @@teachers.keys.shuffle
  end

  def teachers
    @@teachers
  end

  def assign_teacher
    random_list.each_with_index do |t_name, idx|
      slots = @@teachers[t_name]
      if slots.length < MAX_SLOTS
        @teacher = t_name
        slots << @name
        puts "#{@name} is assigned to #{t_name}"
        puts "#{t_name} now has #{MAX_SLOTS - slots.length} slots left"
        return
      end
      if idx == random_list.length - 1
        raise RuntimeError, "There's no room for #{@name}"
      end
    end
  end
end
</pre>
</div>

<div class="code smaller">
<pre style="font-size:16px;line-height:18px;">
require './4_registrar_validated_step1.rb'

s = Student.new("Al", 8)
s.assign_teacher
Al is assigned to Shanahan
Shanahan now has 4 slots left
=> nil
s.teachers
=> {"Shanahan"=>["Al"], "Kovacek"=>[], "Streich"=>[], "Ankunding"=>[], "Marks"=>[]}
</pre>
</div>

<div>
  <h2>Right now, we can keep assigning `s` over and over again until all teachers are full</h2>
</div>

<div class="code smaller">
<pre style="">
(0.upto(25)).each {|i| s.assign_teacher }
...
s.teachers
=> {"Shanahan"=>["Al", "Al", "Al", "Al", "Al"], 
"Kovacek"=>["Al", "Al", "Al", "Al", "Al"], 
"Streich"=>["Al", "Al", "Al", "Al", "Al"], 
"Ankunding"=>["Al", "Al", "Al", "Al", "Al"], 
"Marks"=>["Al", "Al", "Al", "Al", "Al"]}
</pre>
</div>

<div>
  <h2>How can we prevent this?</h2>
</div>

<div class="code smaller">
<pre style="font-size:14px;line-height:18px;">
#5_registrar_validated_step2.rb
class Student
  MAX_SLOTS = 5

  attr_reader :name, :grade, :teacher
  def initialize(name, grade)
    @name  = name
    @grade = grade
    @assigned = false
  end

  @@teachers = {
    "Shanahan"  => [],
    "Kovacek"   => [],
    "Streich"   => [],
    "Ankunding" => [],
    "Marks"     => []
  }

  def random_list
    @@teachers.keys.shuffle
  end

  def teachers
    @@teachers
  end

  def assign_teacher
    raise RuntimeError, "#{@name} is already assigned" if @assigned
    random_list.each_with_index do |t_name, idx|
      slots = @@teachers[t_name]
      if slots.length < MAX_SLOTS
        @teacher = t_name
        slots << @name
        @assigned = true
        puts "#{@name} is assigned to #{t_name}"
        puts "#{t_name} now has #{MAX_SLOTS - slots.length} slots left"
        return
      end
      if idx == random_list.length - 1
        raise RuntimeError, "There's no room for #{@name}"
      end
    end
  end
end
</pre>
</div>

<div class="code smaller">
<pre style="font-size:14px;line-height:18px;">
require './5_registrar_validated_step2'

s = Student.new("Al", 8)
=> #&lt;Student:0x007fd66abe0698 @name="Al", @grade=8, @assigned=false&gt;
s.assign_teacher
Al is assigned to Ankunding
Ankunding now has 4 slots left

s.assign_teacher
RuntimeError: Al is already assigned
  from /Users/ashaw/rails/data-institute/code/5_registrar_validated_step2.rb:28:in `assign_teacher'
  from (irb):4
  from /usr/local/var/rbenv/versions/2.2.2/bin/irb:11:in `&lt;main&gt;'
</pre>
</div>

<div>
  <h2>Homework + Questions</h2>
</div>

  
  <h3>Al Shaw &nbsp;&nbsp; ProPublica Data Institute • 2016 &nbsp;&nbsp; @A_L</h3>
</body>
</html>